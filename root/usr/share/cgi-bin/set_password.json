#!/bin/sh
# include POST/GET READER
. /usr/share/cgi-bin/request
echo "Content-Type: application/json; charset=utf-8"
echo ""
# check arguments
if [ -z "$oldUser" -o -z "$newUser" -o -z "$old" -o -z "$new" ];
 then
  echo "{\"status\":\"1\",\"message\":\"No parameters\"}"
  exit 1
fi
# check password
GIVEN="$oldUser:www:$old"
FOUND=`grep "$oldUser:www:" /etc/lighttpd/.htdigest | head -1`
if [ "$GIVEN" != "$FOUND" ];
 then
  logger "Tried to change router access password, failed, from $REMOTE_ADDR"
  sleep 5
  echo "{\"status\":\"1\",\"message\":\"Bad username or password\"}"
  exit 1
fi
/usr/share/cgi-bin/_set_password.sh "$newUser:www:$new"
echo "{\"status\":\"0\",\"message\":\"OK\"}"
